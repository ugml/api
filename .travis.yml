language: node_js

sudo: required

cache: npm

git:
  quiet: true

env:
  - NODE_ENV=development

services:
  - redis-server

addons:
  mariadb: '10.4'

stages:
  - build
  - lint
  - test

before_script:
  - sudo systemctl start mariadb
  - sudo mysql -u root < test/ci.sql

jobs:
  include:
    - &build
      stage: build
      script: npm run-script build
    - <<: *build
      node_js: '8'
    - <<: *build
      node_js: '10'
    - <<: *build
      node_js: '12'
    - stage: lint
      script: npm run-script lint && npm run-script tslint
    - stage: test
      script: npm run-script test-coverage


after_success:
  - "cat ./coverage/lcov.info | codacy-coverage -p ."
